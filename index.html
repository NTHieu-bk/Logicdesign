<!DOCTYPE HTML>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>B·∫£ng ƒëi·ªÅu khi·ªÉn YOLO UNO</title>

  <link rel="stylesheet" href="styles.css">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/raphael@2.3.0/raphael.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/justgage@1.3.5/justgage.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

  <div class="sidebar">
    <div class="logo-container">
      <i class="fa-solid fa-microchip" style="font-size: 50px; color: var(--active-item-text);"></i>
      <h3 style="margin: 10px 0 0 0; color: var(--sidebar-text);">YOLO UNO</h3>
    </div>

    <div class="nav-item active" onclick="showSection('home', event)">
      <i class="fa-solid fa-house"></i> <span>Trang ch·ªß</span>
    </div>
    <div class="nav-item" onclick="showSection('device', event)">
      <i class="fa-solid fa-bolt"></i> <span>Thi·∫øt b·ªã</span>
    </div>
    <div class="nav-item" onclick="showSection('info', event)">
      <i class="fa-solid fa-circle-info"></i> <span>Th√¥ng tin</span>
    </div>
    <div class="nav-item" onclick="showSection('settings', event)">
      <i class="fa-solid fa-gear"></i> <span>C√†i ƒë·∫∑t</span>
    </div>
  </div>

  <div class="main-content">

    <div id="home" class="section fade-in">
      
      <div class="info-card" style="margin: 20px auto 10px auto; text-align: center; max-width: 500px; border: 2px solid var(--border);">
        <h2 style="justify-content: center; margin-bottom: 5px;">ü§ñ ƒê√°nh gi√° AI (TinyML)</h2>
        
        <h1 id="ai_status_text" style="margin: 10px 0; font-size: 1.8rem; color: var(--success);">
          ƒêANG CH·ªú D·ªÆ LI·ªÜU...
        </h1>

        <p style="color: var(--text-sub); margin: 0;">
          T·ª∑ l·ªá b·∫•t th∆∞·ªùng: <b id="ai_ratio_val">0</b>%
        </p>
      </div>

      <div class="advice-card" style="background: var(--bg-card); padding: 15px; border-radius: 12px; margin: 0 auto 20px auto; max-width: 500px; box-shadow: var(--shadow); border-left: 5px solid #007bff; display: flex; align-items: center; gap: 15px;">
          <div style="font-size: 24px;">üí°</div>
          <div style="text-align: left;">
              <h3 style="margin: 0; font-size: 16px; color: var(--text-main);">L·ªùi khuy√™n h·ªá th·ªëng</h3>
              <p id="sys-advice" style="margin: 5px 0 0 0; font-weight: bold; color: var(--primary); font-size: 1.1rem;">
                  ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...
              </p>
          </div>
      </div>

      <div class="header-container">
        <div>
            <h1>Gi√°m s√°t M√¥i tr∆∞·ªùng</h1>
            <p class="status-text">
            <span id="connStatus" class="dot"></span>
            <i id="wifiIcon" class="fa-solid fa-wifi wifi-icon disconnected"></i>
            <span id="statusText">ƒêang k·∫øt n·ªëi...</span>
            </p>
        </div>
        <div class="control-buttons">
            <button id="unitBtn" class="btn-ctrl" onclick="toggleUnit()">ƒê·ªïi sang ¬∞F</button>
            <button id="themeBtn" class="btn-ctrl" onclick="toggleTheme()">üåô T·ªëi</button>
        </div>
      </div>

      <div class="gauges-container">
        <div class="gauge-card">
          <h2 id="label-temp">üå°Ô∏è Nhi·ªát ƒë·ªô (¬∞C)</h2>
          <div id="gauge_temp" class="gauge-size"></div>
        </div>

        <div class="gauge-card">
          <h2>üíß ƒê·ªô ·∫©m (%)</h2>
          <div id="gauge_humi" class="gauge-size"></div>
        </div>
      </div>

      <div class="chart-wrapper">
        <h3>üìà L·ªãch s·ª≠ d·ªØ li·ªáu</h3>
        <div class="chart-container">
            <canvas id="sensorChart"></canvas>
        </div>
      </div>
    </div>

    <div id="device" class="section" style="display:none;">
      <header>
        <h1>ƒêi·ªÅu khi·ªÉn Relay</h1>
        <p>Qu·∫£n l√Ω v√† ƒëi·ªÅu khi·ªÉn c√°c thi·∫øt b·ªã.</p>
      </header>

      <div class="device-list" id="relayContainer">
        </div>

      <button class="add-relay-btn" onclick="openAddRelayDialog()">
        <i class="fa-solid fa-plus"></i>
      </button>
    </div>

    <div id="info" class="section" style="display:none;">
      <div class="info-card">
        <h2><i class="fa-solid fa-circle-info"></i> Th√¥ng tin h·ªá th·ªëng</h2>

        <div class="info-row">
          <span class="info-label">Ch·∫ø ƒë·ªô Wi-Fi:</span>
          <span id="sys-mode">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">SSID hi·ªán t·∫°i:</span>
          <span id="sys-ssid">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">ƒê·ªãa ch·ªâ IP:</span>
          <span id="sys-ip">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Tr·∫°ng th√°i:</span>
          <span id="sys-status">-</span>
        </div>

        <div class="info-actions">
          <button class="btn-ctrl" type="button" onclick="requestSysInfo()">üîÑ L√†m m·ªõi</button>
          <button id="btnForgetWifi" class="btn-ctrl danger" type="button">
            üßπ Qu√™n Wi-Fi & quay v·ªÅ AP
          </button>
        </div>

        <p class="info-note">
          L∆∞u √Ω: Sau khi b·∫•m <b>Qu√™n Wi-Fi</b>, ESP32 s·∫Ω x√≥a c·∫•u h√¨nh m·∫°ng, 
          t·ª± kh·ªüi ƒë·ªông l·∫°i v√† ph√°t l·∫°i Wi-Fi AP m·∫∑c ƒë·ªãnh. B·∫°n c·∫ßn k·∫øt n·ªëi l·∫°i AP ƒë·ªÉ c·∫•u h√¨nh l·∫ßn n·ªØa.
        </p>
      </div>
    </div>

    <div id="settings" class="section settings-section" style="display:none;">
      <div class="settings-card">
        <h2><i class="fa-solid fa-sliders"></i> C·∫•u h√¨nh h·ªá th·ªëng</h2>
        <p>Nh·∫≠p th√¥ng tin Wi-Fi v√† Server b√™n d∆∞·ªõi.</p>

        <form id="settingsForm">
          <div class="input-group">
            <i class="fa-solid fa-wifi"></i>
            <input type="text" id="ssid" placeholder="T√™n Wi-Fi (SSID)" required>
          </div>

          <div class="input-group">
            <i class="fa-solid fa-lock"></i>
            <input type="password" id="password" placeholder="M·∫≠t kh·∫©u Wi-Fi" required>
          </div>

          <div class="input-group">
            <i class="fa-solid fa-key"></i>
            <input type="text" id="token" placeholder="M√£ Token Core IoT" required>
          </div>

          <div class="input-group">
            <i class="fa-solid fa-server"></i>
            <input type="text" id="server" placeholder="M√°y ch·ªß Core IoT" required>
          </div>

          <div class="input-group">
            <i class="fa-solid fa-plug"></i>
            <input type="number" id="port" placeholder="C·ªïng Core IoT" required min="0">
          </div>

          <button type="submit" class="btn-save">
            <i class="fa-solid fa-floppy-disk"></i> L∆∞u c·∫•u h√¨nh
          </button>
        </form>
      </div>
    </div>
  </div>

  <div id="addRelayDialog" class="dialog-overlay" style="display:none;">
    <div class="dialog fade-in">
      <h3><i class="fa-solid fa-plug"></i> Th√™m relay m·ªõi</h3>
      <div class="input-field">
        <input type="text" id="relayName" placeholder="T√™n relay (VD: ƒê√®n)">
      </div>
      <div class="input-field">
        <input type="number" id="relayGPIO" placeholder="Ch√¢n GPIO (VD: 2)" min="0">
      </div>
      <div class="dialog-buttons">
        <button class="confirm" onclick="saveRelay()">L∆∞u</button>
        <button class="cancel" onclick="closeAddRelayDialog()">H·ªßy</button>
      </div>
    </div>
  </div>

  <div id="confirmDeleteDialog" class="dialog-overlay" style="display:none;">
    <div class="dialog warning fade-in">
      <h3>‚ö†Ô∏è X√°c nh·∫≠n x√≥a</h3>
      <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a thi·∫øt b·ªã n√†y kh√¥ng?</p>
      <div class="dialog-buttons">
        <button class="danger" onclick="confirmDelete()">X√≥a</button>
        <button class="cancel" onclick="closeConfirmDelete()">H·ªßy</button>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>